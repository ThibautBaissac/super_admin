<%# Rendu d'un enregistrement nested %>
<%# Locals: form, association, nested_model_class, nested_attributes, nested_options, new_record, current_depth %>

<% current_depth ||= 1 %>
<% removable = nested_options[:allow_destroy] || new_record %>
<% entry_title = if form.object.respond_to?(:persisted?) && form.object.persisted?
  t("super_admin.resources.nested.entry_existing", model: nested_model_class.model_name.human(count: 1), id: form.object.id)
else
  t("super_admin.resources.nested.entry_new", model: nested_model_class.model_name.human(count: 1))
end %>

<div class="space-y-4 rounded-md border border-gray-200 bg-white p-4"
     data-super-admin--nested-form-entry>
  <div class="flex items-center justify-between">
    <p class="text-sm font-medium text-gray-800">
      <%= entry_title %>
    </p>
    <% if removable %>
      <button type="button"
              class="text-sm font-medium text-red-600 hover:text-red-700"
              data-action="super-admin--nested-form#remove"
              data-super-admin--nested-form-remove>
        <%= t("super_admin.resources.nested.remove") %>
      </button>
    <% end %>
  </div>

  <% if form.object.respond_to?(:persisted?) && form.object.persisted? %>
    <%= form.hidden_field :id %>
  <% end %>

  <% if nested_options[:allow_destroy] %>
    <%= form.hidden_field :_destroy, value: "0" %>
  <% end %>

  <% nested_attributes.each do |attribute| %>
    <%= render "super_admin/shared/form_field", form: form, model_class: nested_model_class, attribute_name: attribute %>
  <% end %>

  <% if nested_options[:allow_destroy] && form.object.respond_to?(:persisted?) && form.object.persisted? %>
    <p class="text-xs text-gray-500">
      <%= t("super_admin.resources.nested.remove_hint") %>
    </p>
  <% end %>
</div>
